<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AstroPred Mini App</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"  rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a1a;
      --card: rgba(30, 30, 50, 0.9);
      --text: white;
      --accent: #9370db;
    }
    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    #stars {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      overflow: hidden;
    }
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: twinkle 2s infinite ease-in-out;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    .main-menu {
      padding: 20px;
      text-align: center;
    }
    .btn {
      display: block;
      margin: 10px auto;
      padding: 12px 20px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 80%;
      max-width: 300px;
    }
    .panel {
      position: fixed;
      top: 0; right: -100%;
      width: 90%;
      height: 100vh;
      background: var(--card);
      padding: 20px;
      transition: right 0.3s ease;
      overflow-y: auto;
    }
    .panel.active {
      right: 0;
    }
    .close {
      float: right;
      background: none;
      border: none;
      color: #ccc;
      font-size: 20px;
      cursor: pointer;
    }
    .profile-info p {
      margin: 10px 0;
    }
    .forecast {
      background: var(--card);
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .history-item {
      background: #222;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="stars"></div>

<!-- Главное меню -->
<div class="main-menu" id="mainMenu">
  <h1 style="color: var(--accent);">Astromir</h1>
  <button class="btn" onclick="showPanel('profile')">Анкета</button>
  <button class="btn" onclick="openForecast('день')">Прогноз на день</button>
  <button class="btn" onclick="openForecast('неделю')">Прогноз на неделю</button>
  <button class="btn" onclick="openForecast('месяц')">Прогноз на месяц</button>
  <button class="btn" onclick="loadCompatibility()">Совместимость</button>
  <button class="btn" onclick="loadHistory()">История</button>
</div>

<!-- Панель анкеты -->
<div class="panel" id="profilePanel">
  <button class="close" onclick="hideAll()">×</button>
  <h2>Анкета</h2>
  <form id="profileForm" onsubmit="saveProfile(event)">
    <label>Имя:</label>
    <input type="text" name="name" required>
    <label>Дата рождения:</label>
    <input type="date" name="birth_date" required>
    <label>Город рождения:</label>
    <input type="text" name="birth_city" required>
    <label>Пол:</label>
    <select name="gender" required>
      <option value="">Выберите</option>
      <option value="м">Мужской</option>
      <option value="ж">Женский</option>
    </select>
    <br><br>
    <button type="submit" class="btn">Сохранить</button>
  </form>
</div>

<!-- Панель прогноза -->
<div class="panel" id="forecastPanel">
  <button class="close" onclick="hideAll()">×</button>
  <h2 id="forecastTitle"></h2>
  <p id="forecastDate"></p>
  <div id="forecastContent"></div>
</div>

<!-- Панель совместимости -->
<div class="panel" id="compatibilityPanel">
  <button class="close" onclick="hideAll()">×</button>
  <h2>Совместимость</h2>
  <div id="compatibilityResult"></div>
</div>

<!-- Панель истории -->
<div class="panel" id="historyPanel">
  <button class="close" onclick="hideAll()">×</button>
  <h2>История прогнозов</h2>
  <div id="historyList"></div>
</div>

<script>
  // Открытие панели
  function showPanel(panelId) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(panelId + 'Panel').classList.add('active');
  }

  // Скрыть все панели
  function hideAll() {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  }

  // Сохранение анкеты
  function saveProfile(e) {
    e.preventDefault();
    const form = document.getElementById('profileForm');
    const data = Object.fromEntries(new FormData(form));
    localStorage.setItem('astroProfile', JSON.stringify(data));
    alert("Анкета сохранена!");
    showProfileView(data);
  }

  // Отображение профиля
  function showProfileView(data) {
    document.getElementById('profilePanel').innerHTML = `
      <button class="close" onclick="hideAll()">×</button>
      <h2>Ваш профиль</h2>
      <div class="profile-info">
        <p><strong>Имя:</strong> ${data.name}</p>
        <p><strong>Дата рождения:</strong> ${data.birth_date}</p>
        <p><strong>Город рождения:</strong> ${data.birth_city}</p>
        <p><strong>Пол:</strong> ${data.gender === 'м' ? 'Мужской' : 'Женский'}</p>
      </div>
      <button class="btn" onclick="editProfile()">Редактировать</button>
    `;
  }

  // Редактирование анкеты
  function editProfile() {
    const data = JSON.parse(localStorage.getItem('astroProfile'));
    document.getElementById('profilePanel').innerHTML = `
      <button class="close" onclick="hideAll()">×</button>
      <h2>Анкета</h2>
      <form id="profileForm" onsubmit="saveProfile(event)">
        <label>Имя:</label>
        <input type="text" name="name" value="${data.name}" required>
        <label>Дата рождения:</label>
        <input type="date" name="birth_date" value="${data.birth_date}" required>
        <label>Город рождения:</label>
        <input type="text" name="birth_city" value="${data.birth_city}" required>
        <label>Пол:</label>
        <select name="gender" required>
          <option value="м" ${data.gender === 'м' ? 'selected' : ''}>Мужской</option>
          <option value="ж" ${data.gender === 'ж' ? 'selected' : ''}>Женский</option>
        </select>
        <br><br>
        <button type="submit" class="btn">Сохранить</button>
      </form>
    `;
  }

  // Генерация прогноза
  function generateForecast(period) {
    const data = JSON.parse(localStorage.getItem('astroProfile'));
    if (!data) {
      alert("Сначала заполните анкету");
      showPanel('profile');
      return;
    }
    const forecast = `
      <div class="forecast">
        <h3>Прогноз для ${data.name}</h3>
        <p>На ${period} вас ждут новые возможности.</p>
        <p>Звезда удачи указывает на ${['рост', 'изобилие', 'стабильность'][Math.floor(Math.random()*3)]}.</p>
      </div>
    `;
    document.getElementById('forecastTitle').innerHTML = `Прогноз на ${period}`;
    document.getElementById('forecastDate').innerText = new Date().toLocaleDateString();
    document.getElementById('forecastContent').innerHTML = forecast;
    saveToHistory(forecast, period);
    showPanel('forecast');
  }

  // Сохранение в историю
  function saveToHistory(content, period) {
    let history = JSON.parse(localStorage.getItem('forecastHistory') || '[]');
    history.unshift({ date: new Date(), content, period });
    localStorage.setItem('forecastHistory', JSON.stringify(history));
  }

  // Загрузка истории
  function loadHistory() {
    const history = JSON.parse(localStorage.getItem('forecastHistory') || '[]');
    const list = document.getElementById('historyList');
    list.innerHTML = '';
    if (history.length === 0) {
      list.innerHTML = '<p>Нет прогнозов</p>';
      return;
    }
    history.forEach((item, index) => {
      list.innerHTML += `
        <div class="history-item" onclick="showHistoryItem(${index})">
          <strong>${item.period}</strong> — ${new Date(item.date).toLocaleDateString()}
        </div>
      `;
    });
    showPanel('history');
  }

  // Показ одного из истории
  function showHistoryItem(index) {
    const history = JSON.parse(localStorage.getItem('forecastHistory'));
    const item = history[index];
    document.getElementById('forecastTitle').innerHTML = `Из истории: ${item.period}`;
    document.getElementById('forecastDate').innerText = new Date(item.date).toLocaleDateString();
    document.getElementById('forecastContent').innerHTML = item.content;
    showPanel('forecast');
  }

  // Анализ совместимости
  function loadCompatibility() {
    const data = JSON.parse(localStorage.getItem('astroProfile'));
    if (!data) {
      alert("Сначала заполните анкету");
      showPanel('profile');
      return;
    }
    const signs = ['Овен', 'Телец', 'Близнецы', 'Рак', 'Лев', 'Дева', 'Весы', 'Скорпион', 'Стрелец', 'Козерог', 'Водолей', 'Рыбы'];
    const partnerSign = signs[Math.floor(Math.random() * signs.length)];
    const score = Math.floor(Math.random() * 100);
    document.getElementById('compatibilityPanel').innerHTML = `
      <button class="close" onclick="hideAll()">×</button>
      <h2>Совместимость</h2>
      <p>Ваш знак: ${getZodiac(data.birth_date)}</p>
      <p>Знак партнера: ${partnerSign}</p>
      <p>Совместимость: <strong>${score}%</strong></p>
    `;
    showPanel('compatibility');
  }

  // Получить знак зодиака
  function getZodiac(dateString) {
    const d = new Date(dateString);
    const day = d.getDate();
    const month = d.getMonth() + 1;
    if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return 'Овен';
    if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return 'Телец';
    if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return 'Близнецы';
    if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return 'Рак';
    if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return 'Лев';
    if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return 'Дева';
    if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return 'Весы';
    if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return 'Скорпион';
    if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return 'Стрелец';
    if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return 'Козерог';
    if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return 'Водолей';
    if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return 'Рыбы';
    return 'Неизвестно';
  }

  // Звёздный фон
  function createStars() {
    const container = document.getElementById('stars');
    for (let i = 0; i < 150; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      container.appendChild(star);
    }
  }

  window.onload = () => {
    createStars();
    const savedData = localStorage.getItem('astroProfile');
    if (savedData) {
      try {
        const data = JSON.parse(savedData);
        showProfileView(data);
      } catch {}
    }
  };

  // Обработчики событий
  window.openForecast = generateForecast;
</script>

</body>
</html>
