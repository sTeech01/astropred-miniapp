<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AstroPred Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css">
  <style>
    :root {
      --primary-color: #9370db;
      --secondary-color: #6a5acd;
      --text-color: #f0f0f0;
      --bg-color: #0a0a1a;
      --card-color: rgba(22, 33, 62, 0.8);
      --error-color: #ff6b6b;
      --success-color: #4caf50;
    }
    
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      color: var(--text-color);
      padding: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }
    
    /* Звездный фон */
    #stars-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    
    .star {
      position: absolute;
      background-color: #fff;
      border-radius: 50%;
      animation: twinkle var(--duration) infinite ease-in-out;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    
    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary-color);
    }
    
    .theme-switch {
      position: absolute;
      top: 20px;
      right: 20px;
      cursor: pointer;
      z-index: 10;
      color: var(--primary-color);
    }
    
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      background: var(--card-color);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .form-group {
      position: relative;
    }
    
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
      color: var(--text-color);
    }
    
    label i {
      margin-right: 8px;
      color: var(--primary-color);
      width: 20px;
      text-align: center;
    }
    
    .field-hint {
      font-size: 12px;
      color: var(--primary-color);
      margin-top: 4px;
      font-style: italic;
    }
    
    input, select, button, textarea {
      padding: 12px 15px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
      background: rgba(0,0,0,0.3);
      color: var(--text-color);
      transition: all 0.3s ease;
    }
    
    input:focus, select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(106, 90, 205, 0.3);
      outline: none;
    }
    
    input:invalid, select:invalid {
      border-color: var(--error-color);
    }
    
    button {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      margin-top: 10px;
      padding: 14px;
    }
    
    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    button:disabled {
      background-color: #555;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .loader {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .app-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-color);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .app-loader-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .error-message {
      color: var(--error-color);
      font-size: 13px;
      margin-top: 5px;
      display: none;
    }
    
    .success-message {
      color: var(--success-color);
      text-align: center;
      margin-top: 15px;
      display: none;
    }
    
    .example-reports {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background: rgba(106, 90, 205, 0.2);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .language-switcher {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
    }
    
    .recommendations {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px dashed rgba(255,255,255,0.2);
    }
    
    .recommendations label {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      font-weight: normal;
      cursor: pointer;
    }
    
    .recommendations input[type="checkbox"] {
      width: auto;
      margin-right: 10px;
    }
    
    /* Анимации */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-group {
      animation: fadeIn 0.5s ease forwards;
      opacity: 0;
    }
    
    /* Прогноз */
    .forecast-container {
      display: none;
      background: var(--card-color);
      padding: 25px;
      border-radius: 15px;
      margin-top: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .forecast-header {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary-color);
    }
    
    .forecast-content {
      line-height: 1.6;
    }
    
    .forecast-section {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px dashed rgba(255,255,255,0.1);
    }
    
    .forecast-section h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    
    /* Анимация появления прогноза */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .forecast-container {
      animation: slideUp 0.5s ease forwards;
    }
    
    /* Главное меню */
    .main-menu {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }
    
    .main-menu button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    /* Стиль для отображения знака зодиака */
    .zodiac-display {
      display: inline-block;
      margin-left: 10px;
      padding: 5px 10px;
      background: rgba(106, 90, 205, 0.3);
      border-radius: 15px;
      font-size: 14px;
      color: var(--primary-color);
    }
    
    /* Стиль для сообщения о консультации */
    .consultation-message {
      display: none;
      margin-top: 15px;
      padding: 10px;
      background: rgba(106, 90, 205, 0.2);
      border-radius: 10px;
      text-align: center;
      color: var(--text-color);
    }
    
    /* Стиль для просмотра анкеты */
    .profile-view {
      background: var(--card-color);
      padding: 25px;
      border-radius: 15px;
      margin-top: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .profile-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px dashed rgba(255,255,255,0.1);
    }
    
    .profile-item strong {
      color: var(--primary-color);
    }
    
    .edit-btn {
      position: absolute;
      top: 20px;
      right: 70px;
      background: none;
      border: none;
      color: var(--primary-color);
      font-size: 16px;
      cursor: pointer;
    }
    
    /* Форма совместимости */
    .compatibility-form {
      display: none;
    }
    
    /* Адаптация для мобильных */
    @media (max-width: 600px) {
      body {
        padding: 15px;
      }
      
      form {
        padding: 15px;
      }
      
      .theme-switch, .language-switcher, .edit-btn {
        position: relative;
        top: auto;
        right: auto;
        left: auto;
        margin-bottom: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="stars-container"></div>
  
  <!-- Загрузчик приложения -->
  <div class="app-loader" id="appLoader">
    <div class="app-loader-spinner"></div>
    <p>Загрузка приложения...</p>
  </div>
  
  <!-- Главное меню -->
  <div id="mainMenu" style="display: none;">
    <h1>AstroPred</h1>
    <div class="main-menu">
      <button id="profileBtn">
        <i class="fas fa-user-edit"></i> Анкета
      </button>
      <button id="dailyForecastBtn">
        <i class="fas fa-sun"></i> Прогноз на день
      </button>
      <button id="weeklyForecastBtn">
        <i class="fas fa-calendar-week"></i> Прогноз на неделю
      </button>
      <button id="monthlyForecastBtn">
        <i class="fas fa-calendar-alt"></i> Прогноз на месяц
      </button>
      <button id="compatibilityBtn">
        <i class="fas fa-heart"></i> Узнать совместимость
      </button>
    </div>
  </div>
  
  <!-- Форма анкеты -->
  <div id="profileFormContainer" style="display: none;">
    <h2 id="profileFormTitle">Анкета</h2>
    <button id="editProfileBtn" class="edit-btn" style="display: none;">
      <i class="fas fa-edit"></i> Редактировать
    </button>
    
    <form id="astroForm" style="display: none;">
      <div class="form-group">
        <label for="name"><i class="fas fa-user"></i>Имя:</label>
        <input type="text" id="name" name="name" required />
        <div class="error-message" id="name-error">Пожалуйста, введите ваше имя</div>
      </div>

      <div class="form-group">
        <label for="birth_date"><i class="fas fa-calendar-day"></i>Дата рождения:</label>
        <input type="date" id="birth_date" name="birth_date" required />
        <div class="error-message" id="birth_date-error">Пожалуйста, введите корректную дату</div>
        <div id="zodiacDisplay" class="zodiac-display" style="display: none;"></div>
      </div>

      <div class="form-group">
        <label for="birth_time"><i class="fas fa-clock"></i>Время рождения (необязательно):</label>
        <input type="time" id="birth_time" name="birth_time" />
        <div class="field-hint">Формат: чч:мм (24-часовой)</div>
      </div>

      <div class="form-group">
        <label for="birth_city"><i class="fas fa-city"></i>Город рождения:</label>
        <input type="text" id="birth_city" name="birth_city" required />
        <div class="error-message" id="birth_city-error">Пожалуйста, укажите город рождения</div>
      </div>

      <div class="form-group">
        <label for="gender"><i class="fas fa-venus-mars"></i>Пол:</label>
        <select id="gender" name="gender" required>
          <option value="">Выберите</option>
          <option value="м">Мужской</option>
          <option value="ж">Женский</option>        
        </select>
        <div class="error-message" id="gender-error">Пожалуйста, выберите пол</div>
      </div>

      <div class="form-group">
        <label for="interest"><i class="fas fa-star"></i>Основной интерес:</label>
        <select id="interest" name="interest" required>
          <option value="">Выберите</option>
          <option value="Любовь и отношения">Любовь и отношения</option>
          <option value="Карьера и бизнес">Карьера и бизнес</option>
          <option value="Финансы и инвестиции">Финансы и инвестиции</option>
          <option value="Здоровье и благополучие">Здоровье и благополучие</option>
          <option value="Семья и дети">Семья и дети</option>
          <option value="Личностный рост">Личностный рост</option>
          <option value="Творчество и вдохновение">Творчество и вдохновение</option>
          <option value="Путешествия и переезды">Путешествия и переезды</option>
          <option value="Духовное развитие">Духовное развитие</option>
          <option value="Образование и обучение">Образование и обучение</option>
          <option value="Важные решения">Важные решения</option>
        </select>
        <div class="error-message" id="interest-error">Пожалуйста, выберите интерес</div>
      </div>

      <div class="form-group">
        <label for="relationship"><i class="fas fa-heart"></i>Семейное положение:</label>
        <select id="relationship" name="relationship" required>
          <option value="">Выберите</option>
          <option value="В паре">В отношениях</option>
          <option value="Не в паре">Не в отношениях</option>
          <option value="В поиске">В поиске</option>
          <option value="В сложных отношениях">В сложных отношениях</option>
        </select>
        <div class="error-message" id="relationship-error">Пожалуйста, укажите семейное положение</div>
      </div>

      <div class="form-group">
        <label for="children"><i class="fas fa-baby"></i>Есть ли дети:</label>
        <select id="children" name="children" required>
          <option value="">Выберите</option>
          <option value="Да">Да</option>
          <option value="Нет">Нет</option>
          <option value="Планируем">Планируем</option>
        </select>
        <div class="error-message" id="children-error">Пожалуйста, укажите, есть ли у вас дети</div>
      </div>

      <div class="form-group">
        <label for="favorite_color"><i class="fas fa-palette"></i>Любимый цвет:</label>
        <input type="color" id="favorite_color" name="favorite_color" value="#6a5acd" required />
        <div class="error-message" id="favorite_color-error">Пожалуйста, выберите цвет</div>
      </div>

      <div class="form-group">
        <label for="fears"><i class="fas fa-flushed"></i>Страхи или тревоги (необязательно):</label>
        <textarea id="fears" name="fears" rows="2"></textarea>
      </div>

      <button type="submit" id="saveProfileBtn">
        <i class="fas fa-save"></i> Сохранить анкету
        <span class="loader" id="loader"></span>
      </button>
    </form>
    
    <div id="profileView" class="profile-view" style="display: none;">
      <!-- Здесь будет отображаться анкета в режиме просмотра -->
    </div>
    
    <button id="backToMenuBtn" style="margin-top: 20px; display: none;">
      <i class="fas fa-arrow-left"></i> Вернуться в меню
    </button>
  </div>
  
  <!-- Прогноз -->
  <div class="forecast-container" id="forecastContainer" style="display: none;">
    <div class="forecast-header">
      <h2 id="forecastTitle"><i class="fas fa-crystal-ball"></i> Ваш персональный астропрогноз</h2>
      <p id="forecastDate"></p>
    </div>
    
    <div class="forecast-content" id="forecastContent">
      <!-- Сюда будет вставлен прогноз -->
    </div>
    
    <button id="backToMenuFromForecastBtn" style="margin-top: 20px;">
      <i class="fas fa-arrow-left"></i> Вернуться в меню
    </button>
  </div>
  
  <!-- Форма совместимости -->
  <div id="compatibilityContainer" style="display: none;">
    <h2><i class="fas fa-heart"></i> Анализ совместимости</h2>
    
    <div id="compatibilityInfo" style="display: none;">
      <div class="profile-view">
        <h3>Ваши данные:</h3>
        <div id="userCompatibilityData"></div>
      </div>
    </div>
    
    <form id="partnerForm" style="display: none;">
      <div class="form-group">
        <label for="partnerName"><i class="fas fa-user"></i>Имя партнера:</label>
        <input type="text" id="partnerName" name="partnerName" required />
      </div>
      
      <div class="form-group">
        <label for="partnerBirthDate"><i class="fas fa-calendar-day"></i>Дата рождения партнера:</label>
        <input type="date" id="partnerBirthDate" name="partnerBirthDate" required />
        <div id="partnerZodiacDisplay" class="zodiac-display" style="display: none;"></div>
      </div>
      
      <div class="form-group">
        <label for="partnerGender"><i class="fas fa-venus-mars"></i>Пол партнера:</label>
        <select id="partnerGender" name="partnerGender" required>
          <option value="">Выберите</option>
          <option value="м">Мужской</option>
          <option value="ж">Женский</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="partnerZodiac"><i class="fas fa-sun"></i>Знак зодиака партнера:</label>
        <select id="partnerZodiac" name="partnerZodiac">
          <option value="">Не знаю</option>
          <option value="Овен">Овен</option>
          <option value="Телец">Телец</option>
          <option value="Близнецы">Близнецы</option>
          <option value="Рак">Рак</option>
          <option value="Лев">Лев</option>
          <option value="Дева">Дева</option>
          <option value="Весы">Весы</option>
          <option value="Скорпион">Скорпион</option>
          <option value="Стрелец">Стрелец</option>
          <option value="Козерог">Козерог</option>
          <option value="Водолей">Водолей</option>
          <option value="Рыбы">Рыбы</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="relationshipDuration"><i class="fas fa-clock"></i>Как долго вы вместе (если применимо):</label>
        <select id="relationshipDuration" name="relationshipDuration">
          <option value="">Не применимо</option>
          <option value="Менее 6 месяцев">Менее 6 месяцев</option>
          <option value="6-12 месяцев">6-12 месяцев</option>
          <option value="1-3 года">1-3 года</option>
          <option value="3-5 лет">3-5 лет</option>
          <option value="Более 5 лет">Более 5 лет</option>
        </select>
      </div>
      
      <button type="submit" id="analyzeCompatibilityBtn">
        <i class="fas fa-heartbeat"></i> Анализировать совместимость
        <span class="loader" id="compatibilityLoader"></span>
      </button>
    </form>
    
    <div id="compatibilityResult" class="forecast-content" style="display: none;">
      <!-- Здесь будет результат анализа совместимости -->
    </div>
    
    <button id="backToMenuFromCompatibilityBtn" style="margin-top: 20px;">
      <i class="fas fa-arrow-left"></i> Вернуться в меню
    </button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
  <script>
    // Инициализация WebApp Telegram
    const tg = window.Telegram.WebApp;
    tg.expand();
    
    // Основные элементы
    const appLoader = document.getElementById('appLoader');
    const mainMenu = document.getElementById('mainMenu');
    const profileBtn = document.getElementById('profileBtn');
    const dailyForecastBtn = document.getElementById('dailyForecastBtn');
    const weeklyForecastBtn = document.getElementById('weeklyForecastBtn');
    const monthlyForecastBtn = document.getElementById('monthlyForecastBtn');
    const compatibilityBtn = document.getElementById('compatibilityBtn');
    const backToMenuBtn = document.getElementById('backToMenuBtn');
    const backToMenuFromForecastBtn = document.getElementById('backToMenuFromForecastBtn');
    const backToMenuFromCompatibilityBtn = document.getElementById('backToMenuFromCompatibilityBtn');
    
    const profileFormContainer = document.getElementById('profileFormContainer');
    const profileForm = document.getElementById('astroForm');
    const profileView = document.getElementById('profileView');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    const forecastContainer = document.getElementById('forecastContainer');
    const forecastContent = document.getElementById('forecastContent');
    const forecastDate = document.getElementById('forecastDate');
    const forecastTitle = document.getElementById('forecastTitle');
    
    const compatibilityContainer = document.getElementById('compatibilityContainer');
    const compatibilityInfo = document.getElementById('compatibilityInfo');
    const userCompatibilityData = document.getElementById('userCompatibilityData');
    const partnerForm = document.getElementById('partnerForm');
    const analyzeCompatibilityBtn = document.getElementById('analyzeCompatibilityBtn');
    const compatibilityResult = document.getElementById('compatibilityResult');
    
    // Создание звездного фона
    function createStars() {
      const starsCount = 200;
      const containerWidth = window.innerWidth;
      const containerHeight = window.innerHeight;
      
      for (let i = 0; i < starsCount; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        
        const size = Math.random() * 3;
        const x = Math.random() * containerWidth;
        const y = Math.random() * containerHeight;
        const duration = 2 + Math.random() * 3 + 's';
        const delay = Math.random() * 5 + 's';
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${x}px`;
        star.style.top = `${y}px`;
        star.style.setProperty('--duration', duration);
        star.style.animationDelay = delay;
        
        document.getElementById('stars-container').appendChild(star);
      }
    }
    
    // Определение знака зодиака по дате рождения
    function getZodiacSign(dateString) {
      if (!dateString) return '';
      
      const date = new Date(dateString);
      const day = date.getDate();
      const month = date.getMonth() + 1;
      
      if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return 'Овен';
      if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return 'Телец';
      if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return 'Близнецы';
      if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return 'Рак';
      if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return 'Лев';
      if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return 'Дева';
      if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return 'Весы';
      if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return 'Скорпион';
      if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return 'Стрелец';
      if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return 'Козерог';
      if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return 'Водолей';
      if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return 'Рыбы';
      
      return '';
    }
    
    // Показ профиля в режиме просмотра
    function showProfileView() {
      const formData = new FormData(profileForm);
      const data = Object.fromEntries(formData.entries());
      const zodiac = getZodiacSign(data.birth_date);
      
      let profileHTML = `
        <div class="profile-item"><strong>Имя:</strong> ${data.name || 'Не указано'}</div>
        <div class="profile-item"><strong>Дата рождения:</strong> ${data.birth_date || 'Не указана'} ${zodiac ? `<span class="zodiac-display">${zodiac}</span>` : ''}</div>
        <div class="profile-item"><strong>Время рождения:</strong> ${data.birth_time || 'Не указано'}</div>
        <div class="profile-item"><strong>Город рождения:</strong> ${data.birth_city || 'Не указан'}</div>
        <div class="profile-item"><strong>Пол:</strong> ${data.gender === 'м' ? 'Мужской' : data.gender === 'ж' ? 'Женский' : 'Не указан'}</div>
        <div class="profile-item"><strong>Основной интерес:</strong> ${data.interest || 'Не указан'}</div>
        <div class="profile-item"><strong>Семейное положение:</strong> ${data.relationship || 'Не указано'}</div>
        <div class="profile-item"><strong>Дети:</strong> ${data.children || 'Не указано'}</div>
        <div class="profile-item"><strong>Любимый цвет:</strong> <span style="display: inline-block; width: 15px; height: 15px; background: ${data.favorite_color || '#6a5acd'}; border-radius: 50%; vertical-align: middle;"></span></div>
        ${data.fears ? `<div class="profile-item"><strong>Страхи/тревоги:</strong> ${data.fears}</div>` : ''}
      `;
      
      profileView.innerHTML = profileHTML;
      profileView.style.display = 'block';
      profileForm.style.display = 'none';
      editProfileBtn.style.display = 'block';
    }
    
    // Генерация прогноза на основе данных
    function generateForecast(data, period = 'день') {
      const zodiac = getZodiacSign(data.birth_date) || 'неизвестным знаком';
      const today = new Date();
      
      // Определяем заголовок в зависимости от периода
      let periodTitle = '';
      let periodSpecificText = '';
      
      switch (period) {
        case 'день':
          periodTitle = 'Прогноз на день';
          periodSpecificText = 'Сегодня особенно благоприятное время для новых начинаний.';
          break;
        case 'неделю':
          periodTitle = 'Прогноз на неделю';
          periodSpecificText = 'На этой неделе ожидаются значительные изменения в вашей жизни.';
          break;
        case 'месяц':
          periodTitle = 'Прогноз на месяц';
          periodSpecificText = 'Этот месяц принесет вам важные события и возможности.';
          break;
      }
      
      const forecastTexts = {
        'Любовь и отношения': [
          `Для ${data.name}, родившегося под знаком ${zodiac}, этот ${period} обещает интересные встречи.`,
          periodSpecificText,
          data.relationship === 'В паре' ? 
            `Ваши отношения в этот ${period} могут перейти на новый уровень.` : 
            `В этот ${period} вас может ждать важная встреча.`
        ],
        'Карьера и бизнес': [
          `Как представитель знака ${zodiac}, вы сейчас находитесь в фазе профессионального роста.`,
          `Этот ${period} особенно благоприятен для карьерных решений.`,
          'Не бойтесь проявлять инициативу - звезды благоволят смелым решениям.'
        ],
        'Финансы и инвестиции': [
          `Ваш знак зодиака (${zodiac}) указывает на необходимость осторожности в финансовых вопросах в этот ${period}.`,
          periodSpecificText,
          'Избегайте импульсивных трат и тщательно анализируйте инвестиции.'
        ]
      };
      
      // Выбираем соответствующий текст прогноза
      const baseTexts = forecastTexts[data.interest] || [
        `Дорогой ${data.name}, как представитель знака ${zodiac}, вы сейчас находитесь под влиянием Марса.`,
        `Этот ${period} принесет вам новые возможности и вызовы.`,
        'Прислушивайтесь к своей интуиции и не бойтесь изменений.'
      ];
      
      // Формируем HTML прогноза
      let forecastHTML = `
        <div class="forecast-section">
          <h3><i class="fas fa-user-astronaut"></i> Персональные данные</h3>
          <p>Имя: ${data.name}</p>
          <p>Знак зодиака: ${zodiac}</p>
        </div>
        
        <div class="forecast-section">
          <h3><i class="fas fa-star"></i> Основной прогноз</h3>
      `;
      
      baseTexts.forEach(text => {
        forecastHTML += `<p>${text}</p>`;
      });
      
      forecastHTML += `</div>`;
      
      // Добавляем рекомендации
      forecastHTML += `
        <div class="forecast-section">
          <h3><i class="fas fa-lightbulb"></i> Рекомендации</h3>
          <p>Благоприятные дни: ${getLuckyDays(zodiac, period)}</p>
          <p>Совет: ${getAdvice(zodiac, data.interest, period)}</p>
          <p>Цвет удачи: ${getLuckyColor(zodiac)}</p>
        </div>
      `;
      
      // Устанавливаем заголовок прогноза
      forecastTitle.innerHTML = `<i class="fas fa-crystal-ball"></i> Ваш персональный астропрогноз на ${period}`;
      
      return forecastHTML;
    }
    
    // Вспомогательные функции для генерации прогноза
    function getLuckyDays(zodiac, period = 'день') {
      const daysMap = {
        'Овен': '5, 12, 19 числа месяца',
        'Телец': '3, 10, 17 числа месяца',
        'Близнецы': '7, 14, 21 числа месяца',
        'Рак': '2, 9, 16 числа месяца',
        'Лев': '6, 13, 20 числа месяца',
        'Дева': '4, 11, 18 числа месяца',
        'Весы': '8, 15, 22 числа месяца',
        'Скорпион': '5, 12, 19 числа месяца',
        'Стрелец': '3, 10, 17 числа месяца',
        'Козерог': '7, 14, 21 числа месяца',
        'Водолей': '2, 9, 16 числа месяца',
        'Рыбы': '6, 13, 20 числа месяца'
      };
      return zodiac && daysMap[zodiac] ? daysMap[zodiac] : '8, 15, 22 числа месяца';
    }
    
    function getAdvice(zodiac, interest) {
      if (interest === 'Любовь и отношения') {
        return zodiac ? 
          `Для ${zodiac} сейчас лучшее время для романтических знакомств` : 
          'Проявите инициативу в личных отношениях';
      } else if (interest === 'Карьера и бизнес') {
        return 'Следующая неделя - лучшее время для важных переговоров';
      } else {
        return 'Прислушивайтесь к своей интуиции в этот период';
      }
    }
    
    function getLuckyColor(zodiac) {
      const colorsMap = {
        'Овен': 'красный',
        'Телец': 'зеленый',
        'Близнецы': 'желтый',
        'Рак': 'серебристый',
        'Лев': 'золотой',
        'Дева': 'бежевый',
        'Весы': 'розовый',
        'Скорпион': 'бордовый',
        'Стрелец': 'фиолетовый',
        'Козерог': 'черный',
        'Водолей': 'голубой',
        'Рыбы': 'синий'
      };
      return zodiac && colorsMap[zodiac] ? colorsMap[zodiac] : 'ваш любимый цвет';
    }
    
    // Обработка отправки формы
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Проверка валидности формы
      if (!form.checkValidity()) {
        Array.from(form.elements).forEach(element => {
          if (element.required && !element.value) {
            const errorElement = document.getElementById(`${element.id}-error`);
            if (errorElement) errorElement.style.display = 'block';
          }
        });
        return;
      }
      
      // Скрываем сообщения об ошибках
      document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
      });
      
      // Показываем индикатор загрузки
      submitBtn.disabled = true;
      loader.style.display = 'block';
      
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      
      // Имитация загрузки (в реальном приложении здесь будет запрос к серверу)
      setTimeout(() => {
        // Генерируем прогноз
        const forecastHTML = generateForecast(data);
        
        // Устанавливаем дату прогноза
        const today = new Date();
        forecastDate.textContent = `Прогноз на ${today.toLocaleDateString('ru-RU', { 
          day: 'numeric', 
          month: 'long', 
          year: 'numeric' 
        })}`;
        
        // Вставляем прогноз
        forecastContent.innerHTML = forecastHTML;
        
        // Показываем прогноз и скрываем форму
        form.style.display = 'none';
        forecastContainer.style.display = 'block';
        
        // Скрываем индикатор загрузки
        submitBtn.disabled = false;
        loader.style.display = 'none';
      }, 1500);
    });
    
    // Кнопка "Вернуться к форме"
    backToFormBtn.addEventListener('click', function() {
      forecastContainer.style.display = 'none';
      form.style.display = 'flex';
    });
    
    // Кнопка "Записаться на консультацию"
    consultationBtn.addEventListener('click', function() {
      consultationMessage.style.display = 'block';
    });
    
    // Создаем звездный фон при загрузке
    window.addEventListener('load', function() {
      createStars();
      
      // Восстановление данных из localStorage
      const savedData = localStorage.getItem('astroFormData');
      if (savedData) {
        const data = JSON.parse(savedData);
        for (const key in data) {
          if (form.elements[key]) {
            form.elements[key].value = data[key];
          }
        }
        // Обновляем отображение знака зодиака, если есть дата рождения
        if (data.birth_date) {
          document.getElementById('birth_date').dispatchEvent(new Event('change'));
        }
      }
    });
    
    // Сохранение данных формы в localStorage
    form.addEventListener('input', function() {
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      localStorage.setItem('astroFormData', JSON.stringify(data));
    });
  </script>
</body>
</html>
