<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astromir</title>
  <style>
    :root {
      --success-color: #4CAF50;
      --error-color: #F44336;
      --info-color: #2196F3;
      --primary-color: #673AB7;
      --background-color: #F5F5F5;
      --text-color: #333;
      --card-bg: #FFFFFF;
      --shadow-color: rgba(0, 0, 0, 0.1);
    }
    body.dark {
      --background-color: #0A0A23;
      --text-color: #E0E0E0;
      --card-bg: #1C2526;
      --shadow-color: rgba(255, 255, 255, 0.1);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      background: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      transition: opacity 0.3s ease, background 0.3s ease, color 0.3s ease;
      position: relative;
      min-height: 100vh;
      overflow: hidden;
    }
    body.dark {
      background: radial-gradient(circle at center, #1C2526 0%, #0A0A23 70%);
    }
    .stars {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    body.dark .stars {
      opacity: 1;
    }
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 2s infinite ease-in-out;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--background-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .loader.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .loader-circle {
      width: 60px;
      height: 60px;
      border: 5px solid var(--primary-color);
      border-top: 5px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loader-text {
      margin-top: 20px;
      font-size: 18px;
      color: var(--primary-color);
      animation: pulse 1.5s infinite ease-in-out;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
      position: relative;
      z-index: 10;
    }
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      transform: rotate(15deg);
    }
    .theme-toggle:active {
      transform: scale(0.9);
    }
    .theme-icon {
      width: 24px;
      height: 24px;
      stroke: var(--text-color);
      transition: stroke 0.3s ease;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 8px var(--shadow-color);
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .progress-bar {
      width: 100%;
      background: #ddd;
      height: 10px;
      border-radius: 5px;
      margin: 20px 0;
    }
    .dark .progress-bar {
      background: #444;
    }
    .progress {
      height: 100%;
      background: var(--primary-color);
      border-radius: 5px;
      width: 0;
      transition: width 0.3s ease;
    }
    .form-step {
      display: none;
    }
    .form-step.active {
      display: block;
    }
    .form-group {
      margin: 15px 0;
      text-align: left;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      background: var(--card-bg);
      color: var(--text-color);
    }
    .form-group input:disabled, .form-group select:disabled {
      background: #eee;
      opacity: 0.7;
      cursor: not-allowed;
    }
    .dark .form-group input, .dark .form-group select {
      border-color: #555;
    }
    .dark .form-group input:disabled, .dark .form-group select:disabled {
      background: #444;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 5px rgba(103, 58, 183, 0.3);
    }
    .success { color: var(--success-color); }
    .error { color: var(--error-color); }
    .info { color: var(--info-color); }
    .zodiac-option::before {
      content: attr(data-emoji);
      margin-right: 8px;
    }
    .button {
      background: var(--primary-color);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease;
      margin: 5px;
      display: block;
      width: 200px;
      margin-left: auto;
      margin-right: auto;
    }
    .button:hover {
      transform: scale(1.05);
    }
    .button:active {
      transform: scale(0.95);
    }
    .button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: ripple 0.6s ease-out;
      pointer-events: none;
    }
    @keyframes ripple {
      to {
        width: 200%;
        height: 200%;
        opacity: 0;
      }
    }
    .share-buttons {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      justify-content: center;
    }
    .share-buttons .button {
      padding: 8px;
      font-size: 14px;
      width: auto;
    }
    .compatibility-chart {
      margin: 20px 0;
    }
    .chart-bar {
      height: 20px;
      margin: 5px 0;
      border-radius: 5px;
      transition: width 0.5s ease;
    }
    .love { background: #FF6B6B; }
    .friendship { background: #4ECDC4; }
    .work { background: #45B7D1; }
    h2, h3 {
      color: var(--primary-color);
      margin: 10px 0;
    }
    .history-item {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
      text-align: left;
    }
    .dark .history-item {
      border-bottom: 1px solid #555;
    }
    .footer {
      margin-top: 20px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div class="loader" id="loader">
    <div class="loader-circle"></div>
    <div class="loader-text">Загрузка приложения...</div>
  </div>
  <div class="stars" id="stars"></div>
  <div class="container">
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Переключить тему">
      <svg class="theme-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 3V5M12 19V21M5.636 5.636L7.05 7.05M16.95 16.95L18.364 18.364M3 12H5M19 12H21M5.636 18.364L7.05 16.95M16.95 7.05L18.364 5.636M12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17Z" stroke="var(--text-color)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <h1>AstroPred</h1>

    <button class="button" onclick="openModal('profile')" aria-label="Открыть анкету">Анкета</button>
    <button class="button" onclick="openModal('daily')" aria-label="Прогноз на день">Прогноз на день</button>
    <button class="button" onclick="openModal('weekly')" aria-label="Прогноз на неделю">Прогноз на неделю</button>
    <button class="button" onclick="openModal('monthly')" aria-label="Прогноз на месяц">Прогноз на месяц</button>
    <button class="button" onclick="openModal('compatibility')" aria-label="Узнать совместимость">Узнать совместимость</button>
    <button class="button" onclick="openModal('history')" aria-label="История прогнозов">История</button>

    <div class="footer">
      <button class="button" onclick="share('main')" aria-label="Поделиться приложением">Поделиться</button>
    </div>
  </div>

  <div id="profileModal" class="modal" role="dialog" aria-labelledby="profileTitle">
    <div class="modal-content">
      <h2 id="profileTitle">Анкета</h2>
      <button class="button" onclick="enableEdit()" aria-label="Редактировать анкету">Редактировать</button>
      <div class="progress-bar">
        <div class="progress" id="progress"></div>
      </div>
      <div id="step1" class="form-step active">
        <div class="form-group">
          <label for="name">Имя:</label>
          <input type="text" id="name" aria-required="true" placeholder="Пожалуйста, введите ваше имя" disabled>
          <p id="nameError" class="error" style="display: none;">Пожалуйста, введите ваше имя</p>
        </div>
        <div class="form-group">
          <label for="birthDate">Дата рождения:</label>
          <input type="date" id="birthDate" aria-required="true" placeholder="Пожалуйста, введите корректную дату" disabled>
          <p id="birthDateError" class="error" style="display: none;">Пожалуйста, введите корректную дату</p>
        </div>
        <div class="form-group">
          <label for="birthTime">Время рождения (необязательно):</label>
          <input type="time" id="birthTime" placeholder="Формат: чч:мм (24-часовой)" disabled>
        </div>
        <button class="button" onclick="nextStep(1)" aria-label="Перейти к следующему шагу">Далее</button>
      </div>
      <div id="step2" class="form-step">
        <div class="form-group">
          <label for="birthCity">Город рождения:</label>
          <input type="text" id="birthCity" aria-required="true" placeholder="Пожалуйста, укажите город рождения" disabled>
          <p id="birthCityError" class="error" style="display: none;">Пожалуйста, укажите город рождения</p>
        </div>
        <div class="form-group">
          <label for="gender">Пол:</label>
          <select id="gender" aria-required="true" disabled>
            <option value="">Выберите</option>
            <option value="male">Мужской</option>
            <option value="female">Женский</option>
          </select>
          <p id="genderError" class="error" style="display: none;">Пожалуйста, выберите пол</p>
        </div>
        <button class="button" onclick="prevStep(2)" aria-label="Вернуться к предыдущему шагу">Назад</button>
        <button class="button" onclick="nextStep(2)" aria-label="Перейти к следующему шагу">Далее</button>
      </div>
      <div id="step3" class="form-step">
        <div class="form-group">
          <label for="interest">Основной интерес:</label>
          <select id="interest" aria-required="true" disabled>
            <option value="">Выберите</option>
            <option value="love">Любовь и отношения</option>
            <option value="career">Карьера и бизнес</option>
            <option value="finance">Финансы и инвестиции</option>
            <option value="health">Здоровье и благополучие</option>
            <option value="family">Семья и дети</option>
            <option value="growth">Личностный рост</option>
            <option value="creativity">Творчество и вдохновение</option>
            <option value="travel">Путешествия и переезды</option>
            <option value="spirituality">Духовное развитие</option>
            <option value="education">Образование и обучение</option>
            <option value="decisions">Важные решения</option>
          </select>
          <p id="interestError" class="error" style="display: none;">Пожалуйста, выберите интерес</p>
        </div>
        <div class="form-group">
          <label for="maritalStatus">Семейное положение:</label>
          <select id="maritalStatus" aria-required="true" disabled>
            <option value="">Выберите</option>
            <option value="in_relationship">В отношениях</option>
            <option value="single">Не в отношениях</option>
            <option value="searching">В поиске</option>
            <option value="complicated">В сложных отношениях</option>
          </select>
          <p id="maritalStatusError" class="error" style="display: none;">Пожалуйста, укажите семейное положение</p>
        </div>
        <div class="form-group">
          <label for="children">Есть ли дети:</label>
          <select id="children" aria-required="true" disabled>
            <option value="">Выберите</option>
            <option value="yes">Да</option>
            <option value="no">Нет</option>
            <option value="planning">Планируем</option>
          </select>
          <p id="childrenError" class="error" style="display: none;">Пожалуйста, укажите, есть ли у вас дети</p>
        </div>
        <div class="form-group">
          <label for="favoriteColor">Любимый цвет:</label>
          <input type="color" id="favoriteColor" aria-required="true" disabled>
          <p id="favoriteColorError" class="error" style="display: none;">Пожалуйста, выберите цвет</p>
        </div>
        <div class="form-group">
          <label for="fears">Страхи или тревоги (необязательно):</label>
          <input type="text" id="fears" placeholder="" disabled>
        </div>
        <button class="button" onclick="prevStep(3)" aria-label="Вернуться к предыдущему шагу">Назад</button>
        <button class="button" onclick="saveProfile()" aria-label="Сохранить анкету">Сохранить анкету</button>
      </div>
      <button class="button" onclick="closeModal('profile')" aria-label="Вернуться в меню">Вернуться в меню</button>
    </div>
  </div>

  <div id="dailyModal" class="modal" role="dialog" aria-labelledby="dailyTitle">
    <div class="modal-content">
      <h2 id="dailyTitle">Ваш персональный астропрогноз</h2>
      <p id="dailyForecast">Загрузка прогноза на день...</p>
      <div class="share-buttons">
        <button class="button" onclick="share('WhatsApp', 'daily')" aria-label="Поделиться в WhatsApp">WhatsApp</button>
        <button class="button" onclick="share('Telegram', 'daily')" aria-label="Поделиться в Telegram">Telegram</button>
      </div>
      <button class="button" onclick="closeModal('daily')" aria-label="Вернуться в меню">Вернуться в меню</button>
    </div>
  </div>

  <div id="weeklyModal" class="modal" role="dialog" aria-labelledby="weeklyTitle">
    <div class="modal-content">
      <h2 id="weeklyTitle">Ваш персональный астропрогноз</h2>
      <p id="weeklyForecast">Загрузка прогноза на неделю...</p>
      <div class="share-buttons">
        <button class="button" onclick="share('WhatsApp', 'weekly')" aria-label="Поделиться в WhatsApp">WhatsApp</button>
        <button class="button" onclick="share('Telegram', 'weekly')" aria-label="Поделиться в Telegram">Telegram</button>
      </div>
      <button class="button" onclick="closeModal('weekly')" aria-label="Вернуться в меню">Вернуться в меню</button>
    </div>
  </div>

  <div id="monthlyModal" class="modal" role="dialog" aria-labelledby="monthlyTitle">
    <div class="modal-content">
      <h2 id="monthlyTitle">Ваш персональный астропрогноз</h2>
      <p id="monthlyForecast">Загрузка прогноза на месяц...</p>
      <div class="share-buttons">
        <button class="button" onclick="share('WhatsApp', 'monthly')" aria-label="Поделиться в WhatsApp">WhatsApp</button>
        <button class="button" onclick="share('Telegram', 'monthly')" aria-label="Поделиться в Telegram">Telegram</button>
      </div>
      <button class="button" onclick="closeModal('monthly')" aria-label="Вернуться в меню">Вернуться в меню</button>
    </div>
  </div>

  <div id="compatibilityModal" class="modal" role="dialog" aria-labelledby="compatTitle">
    <div class="modal-content">
      <h2 id="compatTitle">Анализ совместимости</h2>
      <div class="form-group">
        <h3>Ваши данные:</h3>
        <p id="userData">Загрузка ваших данных...</p>
      </div>
      <div class="form-group">
        <label for="partnerName">Имя партнера:</label>
        <input type="text" id="partnerName" aria-required="true">
      </div>
      <div class="form-group">
        <label for="partnerBirthDate">Дата рождения партнера:</label>
        <input type="date" id="partnerBirthDate" aria-required="true">
      </div>
      <div class="form-group">
        <label for="partnerGender">Пол партнера:</label>
        <select id="partnerGender" aria-required="true">
          <option value="">Выберите</option>
          <option value="male">Мужской</option>
          <option value="female">Женский</option>
        </select>
      </div>
      <div class="form-group">
        <label for="partnerZodiac">Знак зодиака партнера:</label>
        <select id="partnerZodiac" aria-required="true">
          <option value="unknown">Не знаю</option>
          <option value="aries" class="zodiac-option" data-emoji="♈">Овен</option>
          <option value="taurus" class="zodiac-option" data-emoji="♉">Телец</option>
          <option value="gemini" class="zodiac-option" data-emoji="♊">Близнецы</option>
          <option value="cancer" class="zodiac-option" data-emoji="♋">Рак</option>
          <option value="leo" class="zodiac-option" data-emoji="♌">Лев</option>
          <option value="virgo" class="zodiac-option" data-emoji="♍">Дева</option>
          <option value="libra" class="zodiac-option" data-emoji="♎">Весы</option>
          <option value="scorpio" class="zodiac-option" data-emoji="♏">Скорпион</option>
          <option value="sagittarius" class="zodiac-option" data-emoji="♐">Стрелец</option>
          <option value="capricorn" class="zodiac-option" data-emoji="♑">Козерог</option>
          <option value="aquarius" class="zodiac-option" data-emoji="♒">Водолей</option>
          <option value="pisces" class="zodiac-option" data-emoji="♓">Рыбы</option>
        </select>
      </div>
      <div class="form-group">
        <label for="relationshipDuration">Как долго вы вместе (если применимо):</label>
        <select id="relationshipDuration">
          <option value="not_applicable">Не примени  мо</option>
          <option value="less_6m">Менее 6 месяцев</option>
          <option value="6m_1y">6-12 месяцев</option>
          <option value="1y_3y">1-3 года</option>
          <option value="3y_5y">3-5 лет</option>
          <option value="over_5y">Более 5 лет</option>
        </select>
      </div>
      <button class="button" onclick="analyzeCompatibility()" aria-label="Анализировать совместимость">Анализировать совместимость</button>
      <div class="compatibility-chart" id="compatChart" style="display: none;">
        <h3>Результаты совместимости</h3>
        <div>Любовь: <div class="chart-bar love" id="loveBar" style="width: 0;"></div></div>
        <div>Дружба: <div class="chart-bar friendship" id="friendshipBar" style="width: 0;"></div></div>
        <div>Работа: <div class="chart-bar work" id="workBar" style="width: 0;"></div></div>
      </div>
      <div class="share-buttons">
        <button class="button" onclick="share('WhatsApp', 'compat')" aria-label="Поделиться в WhatsApp">WhatsApp</button>
        <button class="button" onclick="share('Telegram', 'compat')" aria-label="Поделиться в Telegram">Telegram</button>
      </div>
      <button class="button" onclick="closeModal('compatibility')" aria-label="Вернуться в меню">Вернуться в меню</button>
    </div>
  </div>

  <div id="historyModal" class="modal" role="dialog" aria-labelledby="historyTitle">
    <div class="modal-content">
      <h2 id="historyTitle">История прогнозов</h2>
      <div id="historyList"></div>
      <button class="button" onclick="closeModal('history')" aria-label="Вернуться в меню">Вернуться в меню</button>
    </div>
  </div>

  <script>
    let currentStep = 1;
    const totalSteps = 3;
    let isEditing = false;

    // Create stars for dark mode
    function createStars() {
      const starsContainer = document.getElementById('stars');
      for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.width = `${Math.random() * 3 + 1}px`;
        star.style.height = star.style.width;
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 2}s`;
        starsContainer.appendChild(star);
      }
    }

    // Hide loader after 2 seconds
    window.onload = function() {
      createStars();
      setTimeout(() => {
        document.getElementById('loader').classList.add('hidden');
      }, 2000);
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark');
      }
      loadProfile();
    };

    function loadProfile() {
      const profile = JSON.parse(localStorage.getItem('profile') || '{}');
      if (profile.name) {
        document.getElementById('name').value = profile.name;
        document.getElementById('birthDate').value = profile.birthDate;
        document.getElementById('birthTime').value = profile.birthTime || '';
        document.getElementById('birthCity').value = profile.birthCity;
        document.getElementById('gender').value = profile.gender;
        document.getElementById('interest').value = profile.interest;
        document.getElementById('maritalStatus').value = profile.maritalStatus;
        document.getElementById('children').value = profile.children;
        document.getElementById('favoriteColor').value = profile.favoriteColor;
        document.getElementById('fears').value = profile.fears || '';
      }
    }

    function enableEdit() {
      isEditing = true;
      document.querySelectorAll('#profileModal input, #profileModal select').forEach(el => {
        el.disabled = false;
      });
    }

    function openModal(section) {
      document.body.style.opacity = '0';
      setTimeout(() => {
        document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
        const modal = document.getElementById(section + 'Modal');
        modal.style.display = 'flex';
        modal.querySelector('input, select, button').focus();
        document.body.style.opacity = '1';
        if (section === 'profile') {
          currentStep = 1;
          updateProgress();
          loadProfile();
        }
        if (section === 'daily' || section === 'weekly' || section === 'monthly') {
          checkProfileAndLoad(section);
        }
        if (section === 'compatibility') loadUserData();
        if (section === 'history') loadHistory();
      }, 300);
    }

    function closeModal(section) {
      document.body.style.opacity = '0';
      setTimeout(() => {
        document.getElementById(section + 'Modal').style.display = 'none';
        document.body.style.opacity = '1';
      }, 300);
    }

    function updateProgress() {
      const progress = document.getElementById('progress');
      progress.style.width = `${(currentStep / totalSteps) * 100}%`;
      document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
      document.getElementById(`step${currentStep}`).classList.add('active');
    }

    function nextStep(current) {
      if (validateStep(current)) {
        currentStep++;
        updateProgress();
      }
    }

    function prevStep(current) {
      currentStep--;
      updateProgress();
    }

    function validateStep(step) {
      let valid = true;
      if (step === 1) {
        const name = document.getElementById('name').value;
        const birthDate = document.getElementById('birthDate').value;
        document.getElementById('nameError').style.display = name ? 'none' : 'block';
        document.getElementById('birthDateError').style.display = birthDate ? 'none' : 'block';
        valid = name && birthDate;
      } else if (step === 2) {
        const birthCity = document.getElementById('birthCity').value;
        const gender = document.getElementById('gender').value;
        document.getElementById('birthCityError').style.display = birthCity ? 'none' : 'block';
        document.getElementById('genderError').style.display = gender ? 'none' : 'block';
        valid = birthCity && gender;
      } else if (step === 3) {
        const interest = document.getElementById('interest').value;
        const maritalStatus = document.getElementById('maritalStatus').value;
        const children = document.getElementById('children').value;
        const favoriteColor = document.getElementById('favoriteColor').value;
        document.getElementById('interestError').style.display = interest ? 'none' : 'block';
        document.getElementById('maritalStatusError').style.display = maritalStatus ? 'none' : 'block';
        document.getElementById('childrenError').style.display = children ? 'none' : 'block';
        document.getElementById('favoriteColorError').style.display = favoriteColor ? 'none' : 'block';
        valid = interest && maritalStatus && children && favoriteColor;
      }
      return valid;
    }

    function saveProfile() {
      if (validateStep(3)) {
        const profile = {
          name: document.getElementById('name').value,
          birthDate: document.getElementById('birthDate').value,
          birthTime: document.getElementById('birthTime').value,
          birthCity: document.getElementById('birthCity').value,
          gender: document.getElementById('gender').value,
          interest: document.getElementById('interest').value,
          maritalStatus: document.getElementById('maritalStatus').value,
          children: document.getElementById('children').value,
          favoriteColor: document.getElementById('favoriteColor').value,
          fears: document.getElementById('fears').value
        };
        localStorage.setItem('profile', JSON.stringify(profile));
        const success = document.createElement('p');
        success.className = 'success';
        success.textContent = 'Анкета успешно сохранена!';
        document.getElementById('step3').appendChild(success);
        setTimeout(() => {
          success.remove();
          document.querySelectorAll('#profileModal input, #profileModal select').forEach(el => {
            el.disabled = true;
          });
          isEditing = false;
        }, 3000);
      }
    }

    function loadUserData() {
      const profile = JSON.parse(localStorage.getItem('profile') || '{}');
      document.getElementById('userData').textContent = profile.name 
        ? `Имя: ${profile.name}, Дата рождения: ${profile.birthDate}, Город: ${profile.birthCity}`
        : 'Данные не заполнены';
    }

    function checkProfileAndLoad(type) {
      const profile = JSON.parse(localStorage.getItem('profile') || '{}');
      if (!profile.name || !profile.birthDate || !profile.birthCity || !profile.gender || 
          !profile.interest || !profile.maritalStatus || !profile.children || !profile.favoriteColor) {
        document.getElementById(`${type}Forecast`).textContent = 'Заполните пожалуйста анкету';
        document.getElementById(`${type}Forecast`).className = 'error';
      } else {
        loadForecast(type);
      }
    }

    function loadForecast(type) {
      const profile = JSON.parse(localStorage.getItem('profile') || '{}');
      const forecast = type === 'daily' ? 'Прогноз на день: Удача в делах и гармония в отношениях.'
        : type === 'weekly' ? 'Прогноз на неделю: Новая возможность в карьере, будьте внимательны.'
        : 'Прогноз на месяц: Стабильность в финансах, время для личностного роста.';
      document.getElementById(`${type}Forecast`).textContent = profile.name 
        ? `${profile.name}, ${forecast}` : forecast;
      document.getElementById(`${type}Forecast`).className = '';
      saveToHistory(type, forecast);
    }

    function saveToHistory(type, forecast) {
      const history = JSON.parse(localStorage.getItem('forecastHistory') || '[]');
      history.push({ type, forecast, date: new Date().toLocaleString() });
      localStorage.setItem('forecastHistory', JSON.stringify(history));
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('forecastHistory') || '[]');
      const list = document.getElementById('historyList');
      list.innerHTML = '';
      history.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.textContent = `${item.date} - ${item.type}: ${item.forecast}`;
        list.appendChild(div);
      });
    }

    function analyzeCompatibility() {
      const love = Math.floor(Math.random() * 100);
      const friendship = Math.floor(Math.random() * 100);
      const work = Math.floor(Math.random() * 100);
      const chart = document.getElementById('compatChart');
      chart.style.display = 'block';
      document.getElementById('loveBar').style.width = `${love}%`;
      document.getElementById('friendshipBar').style.width = `${friendship}%`;
      document.getElementById('workBar').style.width = `${work}%`;
      const result = `Совместимость: Любовь ${love}%, Дружба ${friendship}%, Работа ${work}%`;
      saveToHistory('compatibility', result);
    }

    function share(platform, type = 'main') {
      let text = 'Прогноз от AstroPred';
      if (type !== 'main') {
        text = document.getElementById(`${type}Forecast`)?.textContent || 
               document.getElementById('compatChart').style.display !== 'none' 
               ? `Совместимость: Любовь ${document.getElementById('loveBar').style.width}, ` +
                 `Дружба ${document.getElementById('friendshipBar').style.width}, ` +
                 `Работа ${document.getElementById('workBar').style.width}` 
               : 'Прогноз от AstroPred';
      }
      const url = platform === 'WhatsApp' 
        ? `https://wa.me/?text=${encodeURIComponent(text)}`
        : `https://t.me/share/url?url=${encodeURIComponent(text)}`;
      window.open(url, '_blank');
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }
  </script>
</body>
</html>
